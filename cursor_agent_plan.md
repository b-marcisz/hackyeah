# План действий для Cursor-агента (Game API)

## 1. Подготовка окружения
- Убедиться, что backend-сервис запущен (`npm run start:dev`).
- Проверить доступность базы данных и наличие необходимых миграций.
- Настроить переменные среды: `DB_HOST`, `DB_PORT`, `DB_USERNAME`, `DB_PASSWORD`, `DB_DATABASE`, `OPENAI_API_KEY` (если требуется генерация).

## 2. Базовый сценарий использования Game API
1. **Старт игры**
   - Запрос: `POST /api/games/start`
   - Тело запроса (пример):
     ```json
     {
       "type": "match_hao",
       "number": 42,
       "playerId": "<uuid игрока>",
       "difficulty": 2,
       "settings": {
         "memorizationTime": 5
       }
     }
     ```
   - Ожидаемый ответ содержит `id` игры, `state` с ассоциацией и статус `in_progress`.

2. **Получение состояния игры**
   - Запрос: `GET /api/games/{id}`
   - Используется для чтения текущего состояния и отображения данных игроку.

3. **Отправка ответа игрока**
   - Запрос: `POST /api/games/{id}/answer`
   - Тело запроса (пример для `match_hao`):
     ```json
     {
       "answer": {
         "hero": "Hero",
         "action": "Action",
         "object": "Object"
       },
       "timeSpentMs": 1200
     }
     ```
   - В ответе ожидаем `status` (`completed`/`failed`), начисленные `points`, `xp`, а также `result.summary`.

4. **Получение итогов игры**
   - Запрос: `GET /api/games/{id}/result`
   - Используется после отправки ответа для отображения итоговой статистики.

5. **Отправка обратной связи**
   - Запрос: `POST /api/games/{id}/feedback`
   - Пример тела:
     ```json
     {
       "message": "Продлить время на запоминание",
       "rating": 4
     }
     ```
   - Ответ содержит обновлённый массив `feedback`.

## 3. Обработка сценариев по типам игр
- `match_hao`: проверять корректность героя, действия и объекта (строгое совпадение по регистронезависимому сравнению).
- `memory_flash`: агент должен менять фазу UI в соответствии с `state.phase`, соблюдать `memorizationTime`, после смены сцены отправлять `changedElement` в `answer`.
- `speed_recall`: отслеживать количество попыток (`state.attempts`), анализировать объекты ассоциации и сравнивать с ответами пользователя.

## 4. Ошибки и валидация
- Обрабатывать HTTP 400 при повторной отправке ответа, когда игра уже завершена.
- HTTP 404 — нет ассоциации или игра не найдена (важно ретраить только после проверки входных данных).
- Для DTO используется строгая валидация: агент должен отправлять только whitelisted поля.

## 5. Логирование и телеметрия
- Фиксировать `gameId`, `playerId`, `status` и временные метки при каждом запросе.
- Сохранять точки интеграции для последующего расширения (XP, streaks и т.д.).

## 6. Расширение плана
- Добавить генерацию декой-карточек для `match_hao` при появлении соответствующей логики.
- Реализовать адаптивный скоринг после внедрения системы бонусов.
- Подготовить тесты API (e2e) после завершения основных сценариев.

